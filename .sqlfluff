# SQLFluff Configuration for dbt_olist_project
# This file defines SQL linting and formatting standards
# Documentation: https://docs.sqlfluff.com/en/stable/

[sqlfluff]
# Snowflake dialect for our dbt project
dialect = snowflake
templater = jinja

# SQL formatting preferences (updated config format)
max_line_length = 100
large_file_skip_byte_limit = 40000

# Template configuration for Jinja (fallback without dbt credentials)
[sqlfluff:templater:jinja]
apply_dbt_builtins = true

# Indentation configuration
[sqlfluff:indentation]
indent_unit = space
tab_space_size = 4

# Layout configuration
[sqlfluff:layout:type:comma]
line_position = leading

# Rule configuration - follow dbt community standards
[sqlfluff:rules]
# Capitalization rules - follow dbt community standards
capitalisation_policy = lower
extended_capitalisation_policy = lower

# Trailing commas enforcement
allow_scalar = true
single_table_references = consistent
unqualified_column_reference = column

[sqlfluff:rules:aliasing.table]
# Table aliasing standards
aliasing = explicit

[sqlfluff:rules:aliasing.column]
# Column aliasing standards
aliasing = explicit

[sqlfluff:rules:capitalisation.keywords]
# SQL keywords should be lowercase
capitalisation_policy = lower

[sqlfluff:rules:capitalisation.identifiers]
# Identifiers (table names, column names) should be lowercase
capitalisation_policy = lower

[sqlfluff:rules:capitalisation.functions]
# Function names should be lowercase
capitalisation_policy = lower

[sqlfluff:rules:capitalisation.literals]
# String literals can be any case
capitalisation_policy = consistent

[sqlfluff:rules:layout.long_lines]
# Line length enforcement
ignore_comment_lines = true
ignore_comment_clauses = true

[sqlfluff:rules:references.consistent]
# Enforce consistent table references
single_table_references = consistent

# Disable some rules that conflict with dbt patterns
[sqlfluff:rules:references.from]
# Allow FROM clauses without table aliases (common in dbt)
force_enable = false

[sqlfluff:rules:structure.subquery]
# Allow subqueries in FROM clauses (dbt CTEs)
forbid_subquery_in = join

# Custom rules for dbt best practices (commented out - requires dbt plugin)
# [sqlfluff:rules:dbt.check_model_columns_have_desc]
# # Ensure model columns are documented
# manifest_path = target/manifest.json

# [sqlfluff:rules:dbt.check_model_has_description]
# # Ensure models have descriptions
# manifest_path = target/manifest.json
